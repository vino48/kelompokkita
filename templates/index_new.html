<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Monitoring</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        function updateData() {
            fetch('/data').then(response => response.json()).then(data => {
                document.getElementById('gas-value').innerText = data.gas;
                document.getElementById('smoke-value').innerText = data.smoke;
                document.getElementById('temp-value').innerText = data.temp + ' Â°C';
                document.getElementById('humid-value').innerText = data.humid + ' %';
                document.getElementById('gas-status').innerText = data.gas_status;
                document.getElementById('smoke-status').innerText = data.smoke_status;
            });
        }

        function toggleAlarm(status) {
            fetch('/set_alarm', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status })
            }).then(response => response.json()).then(data => {
                alert(data.message);
            });
        }

        setInterval(updateData, 5000);
    </script>


      <link href="/static/assets/img/logosmk.jpg" rel="icon">
  <link href="/static/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="/static/assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="/static/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/static/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/static/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="/static/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="/static/assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="/static/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="/static/assets/css/style.css" rel="stylesheet">


</head>
<body>
<header id="header" class="fixed-top d-flex align-items-center">
    <div class="container d-flex align-items-center justify-content-between">
 <div class="logo">
        <h1><a href="index.html">NAHENKO</a></h1>
        <!-- Uncomment below if you prefer to use an image logo -->
        <!-- <a href="index.html"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->
      </div>

 <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto active" href="#hero">Home</a></li>
          <li><a class="nav-link scrollto" href="#about">About</a></li>
         <!-- <li><a class="nav-link scrollto" href="#services">Services</a></li>
          <li><a class="nav-link scrollto " href="#portfolio">Portfolio</a></li>
          <li><a class="nav-link scrollto" href="#team">Team</a></li>
          <li><a class="nav-link scrollto" href="#pricing">Pricing</a></li>
          <li class="dropdown"><a href="#"><span>Drop Down</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a href="#">Drop Down 1</a></li>
              <li class="dropdown"><a href="#"><span>Deep Drop Down</span> <i class="bi bi-chevron-right"></i></a>
                <ul>
                  <li><a href="#">Deep Drop Down 1</a></li>
                  <li><a href="#">Deep Drop Down 2</a></li>
                  <li><a href="#">Deep Drop Down 3</a></li>
                  <li><a href="#">Deep Drop Down 4</a></li>
                  <li><a href="#">Deep Drop Down 5</a></li>
                </ul>
              </li>
              <li><a href="#">Drop Down 2</a></li>
              <li><a href="#">Drop Down 3</a></li>
              <li><a href="#">Drop Down 4</a></li>
            </ul>
          </li>
          <li><a class="nav-link scrollto" href="#contact">Contact</a></li>-->
          <li><a class="getstarted scrollto" href="#about">Get Started</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->
           </div>
  </header><!-- End Header -->

 <section id="hero" class="d-flex align-items-center">

    <div class="container">
      <div class="row">
        <div class="col-lg-6 pt-5 pt-lg-0 order-2 order-lg-1 d-flex flex-column justify-content-center">
          <h1 data-aos="fade-up">Dashboard Monitoring </h1>
          <h2 data-aos="fade-up" data-aos-delay="400">Smart Home Berkelanjutan</h2>

        </div>
        <div class="col-lg-6 order-1 order-lg-2 hero-img" data-aos="fade-left" data-aos-delay="200">
          <img src="/static/assets/img/logo.jpg" alt="" class="img-fluid">
        </div>
      </div>
    </div>

  </section><!-- End Hero -->



  <!-- ======= Counts Section ======= -->
    <section id="counts" class="counts">
      <div class="container">

        <div class="row">

            <div class="col-lg-4 col-md-6">
                <div class="small-box bg-secondary" id="gasBox">
                    <div class="inner">
                        <h3 id="gas">GAGAL</h3>
                        <p>Gas Mase</p>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="small-box bg-secondary" id="smokeBox">
                    <div class="inner">
                        <h3 id="smoke">GAGAL</h3>
                        <p>Smoke</p>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="small-box bg-secondary" id="tempBox">
                    <div class="overlay">
                        <i class="fas fa-2x fa-sync-alt fa-spin"></i>
                    </div>
                    <div class="inner">
                        <h3 id="temp">GAGAL</h3>
                        <p>Temperature</p>
                    </div>
                </div>
            </div><h2>Kontrol Alarm</h2>
            <div class="image col-xl-5 d-flex align-items-stretch justify-content-center justify-content-xl-start" data-aos="fade-right" data-aos-delay="150">
            <img src="/static/assets/img/logo.jpg" alt="" class="img-fluid">
          </div>

          <div class="col-xl-7 d-flex align-items-stretch pt-4 pt-xl-0" data-aos="fade-left" data-aos-delay="300">
            <div class="content d-flex flex-column justify-content-center">
              <div class="row">


                <div class="col-md-6 d-md-flex align-items-md-stretch">
                  <div class="count-box">
                    <i class="bi bi-emoji-smile"></i>
                    <span data-purecounter-start="0"  data-purecounter-duration="1" class="purecounter" id="gas-alarm">OFF</span>
                      <table> <tr><td>
                        <button class="btn btn-sm btn-primary float-start" onclick="setAlarm('gas')">ON/OFF</button>
                      </td></tr><tr><td>
                        <button class="btn btn-sm btn-primary float-start" >GAS</button>
                      </td></tr></table>
                  </div>
                </div>

                <div class="col-md-6 d-md-flex align-items-md-stretch">
                  <div class="count-box">
                    <i class="bi bi-journal-richtext"></i>
                      <span data-purecounter-start="0" data-purecounter-duration="1" class="purecounter" id="smoke-alarm">OFF</span>
                        <table> <tr><td>
                          <span><button class="btn btn-sm btn-primary float-start" onclick="setAlarm('smoke')">ON/OFF</button></span>
                        </td></tr><tr><td>
                          <p><button class="btn btn-sm btn-primary float-start" >Asap</button></p>
                        </td></tr></table>
                  </div>
                </div>

                <div class="col-md-6 d-md-flex align-items-md-stretch">
                  <div class="count-box">
                    <i class="bi bi-clock"></i>
                    <span data-purecounter-start="0"  data-purecounter-duration="1" class="purecounter" id="temp-alarm">OFF</span>
                    <table> <tr><td>
                      <button class="btn btn-sm btn-primary float-start" onclick="setAlarm('temp')">ON/OFF</button>
                    </td></tr><tr><td>
                      <button class="btn btn-sm btn-primary float-start" >Suhu</button>
                    </td></tr></table>
                  </div>
                </div>


                <div class="col-md-6 d-md-flex align-items-md-stretch">
                  <div class="count-box">
                    <i class="bi bi-award"></i>
                    <span data-purecounter-start="0" data-purecounter-duration="1" class="purecounter" id="humidity-alarm">OFF</span>
                    <table> <tr><td>
                      <button class="btn btn-sm btn-primary float-start" onclick="setAlarm('humidity')">ON/OFF</button>
                    </td></tr><tr><td>
                      <button class="btn btn-sm btn-primary float-start" >Kelembapan</button>
                    </td></tr></table>
                  </div>
                </div>

              </div>
            </div><!-- End .content-->
          </div>
        </div>

      </div>
    </section><!-- End Counts Section -->

<footer class="text-center mt-5 py-3 bg-light">
        <strong>Copyright &copy; <span id="year"></span> Keamanan Lingkungan.</strong>
    </footer>

    <script>
        document.getElementById("year").innerText = new Date().getFullYear();

        async function fetchData() {
            try {
                const response = await fetch("/data");
                if (!response.ok) throw new Error("Gagal mengambil data");
                const data = await response.json();
                document.getElementById("gas").innerText = data.gas || "N/A";
                document.getElementById("smoke").innerText = data.smoke || "N/A";
                document.getElementById("temp").innerText = data.temp || "N/A";
                updateBoxes();
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        function updateBoxes() {
            updateBox("gas", "gasBox");
            updateBox("smoke", "smokeBox");
            updateBox("temp", "tempBox");
        }

        function updateBox(id, boxId) {
            let value = document.getElementById(id).innerText;
            let box = document.getElementById(boxId);

            if (!value || value === "GAGAL") {
                box.className = "small-box bg-secondary";
            } else {
                let number = parseFloat(value);
                box.className = number > 13000 ? "small-box bg-danger" : "small-box bg-success";
            }
        }

        setInterval(fetchData, 3000);
    </script>

<script>
    async function fetchData() {
        const response = await fetch('/data');
        const data = await response.json();

        document.getElementById('gas-alarm').innerText = data.gas_status;
        document.getElementById('smoke-alarm').innerText = data.smoke_status;
        document.getElementById('temp-alarm').innerText = data.temp > 30 ? 'Berbahaya' : 'Aman';
        document.getElementById('humidity-alarm').innerText = data.humidity > 70 ? 'Berbahaya' : 'Aman';
    }

    async function setAlarm(type) {
        const status = document.getElementById(`${type}-alarm`).innerText === "OFF" ? "ON" : "OFF";
        await fetch('/set_alarm', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ type, status })
        });
        fetchData();
    }

    setInterval(fetchData, 2000);
</script>



<!-- Vendor JS Files -->
  <script src="/static/assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="/static/assets/vendor/aos/aos.js"></script>
  <script src="/static/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/static/assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="/static/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="/static/assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="/static/assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="/static/assets/js/main.js"></script>
</body>
</html>
